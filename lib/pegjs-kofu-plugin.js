// Generated by KofuScript 0.1.0-beta6 
var present = console.log; 
// Generated by KofuScript 0.1.0-beta6 
var compile, eachCode, KofuScript;
KofuScript = require('./module');
eachCode = require('pegjs-each-code');
compile = function (ksCode, options) {
  var jsAST, ksAST;
  if (null == options)
    options = {};
  ksAST = KofuScript.parse('-> ' + ksCode.trimRight());
  if (ksAST.body.statements.length > 1)
    throw new Error('inconsistent base indentation');
  jsAST = KofuScript.compile(ksAST, {
    bare: true,
    inScope: options.inScope
  });
  jsAST.leadingComments = [];
  jsAST.body = jsAST.body[0].expression.body.body.concat(jsAST.body.slice(1));
  return KofuScript.js(jsAST);
};
exports.use = function (config) {
  return config.passes.transform.unshift(function (ast) {
    ast.initializer.code = KofuScript.cs2js(ast.initializer.code, { bare: true });
    return eachCode(ast, function (node, labels, ruleName) {
      var error;
      try {
        return node.code = compile(node.code, { inScope: labels });
      } catch (e$) {
        error = e$;
        throw new Error("In the '" + ruleName + "' rule:\n" + error.message + '');
      }
    });
  });
};
